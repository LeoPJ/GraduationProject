import pymysql
import time
import matplotlib.pyplot as plt
import numpy as np
import matplotlib.font_manager as mfm
import os

def str2time(a1):
	# 先转换为时间数组
	timeArray = time.strptime(a1, "%Y-%m-%d %H:%M:%S")
	# 转换为时间戳
	timeStamp = int(time.mktime(timeArray))
	return timeStamp

behavior=[('android', 1.0, '2017-10-24 10:04:34', '2017-10-24 10:04:50', 70.503, 86.623), ('android', 1.0, '2017-10-24 10:05:04', '2017-10-24 10:05:33', 193.343, 222.503), ('android', 1.0, '2017-10-24 10:08:17', '2017-10-24 10:08:22', 212.223, 216.703), ('android', 1.0, '2017-10-24 10:08:27', '2017-10-24 10:08:38', 200.83, 211.543), ('android', 1.0, '2017-10-24 10:08:38', '2017-10-24 10:08:41', 211.583, 214.503), ('android', 1.0, '2017-10-24 10:08:41', '2017-10-24 10:08:46', 214.543, 218.823), ('android', 2.0, '2017-10-24 10:08:46', '2017-10-24 10:08:51', 218.983, 229.543), ('android', 0.5, '2017-10-24 10:08:59', '2017-10-24 10:09:24', 199.0, 210.223), ('android', 0.5, '2017-10-24 10:09:24', '2017-10-24 10:09:44', 200.955, 210.383), ('android', 0.5, '2017-10-24 10:09:44', '2017-10-24 10:10:02', 195.698, 202.823), ('android', 0.5, '2017-10-24 10:10:46', '2017-10-24 10:10:59', 203.303, 209.623), ('android', 0.5, '2017-10-24 10:11:20', '2017-10-24 10:11:29', 205.829, 208.863), ('android', 0.5, '2017-10-24 10:13:53', '2017-10-24 10:14:10', 202.383, 210.943), ('android', 0.5, '2017-10-24 10:14:10', '2017-10-24 10:14:15', 208.12, 210.223), ('android', 0.5, '2017-10-24 10:14:15', '2017-10-24 10:14:23', 206.942, 210.263), ('android', 0.5, '2017-10-24 10:14:44', '2017-10-24 10:14:52', 210.743, 214.663), ('android', 0.5, '2017-10-24 10:14:58', '2017-10-24 10:15:14', 203.164, 210.343), ('android', 0.5, '2017-10-24 10:15:14', '2017-10-24 10:15:47', 197.636, 212.543), ('android', 0.5, '2017-10-24 10:18:55', '2017-10-24 10:19:13', 201.654, 209.263), ('android', 1.0, '2017-10-24 10:24:22', '2017-10-24 10:24:37', 197.724, 210.863), ('android', 1.0, '2017-10-24 10:25:30', '2017-10-24 10:25:55', 203.609, 227.423), ('android', 1.0, '2017-10-24 10:32:29', '2017-10-24 10:32:43', 205.0, 218.863), ('android', 1.0, '2017-10-24 10:33:05', '2017-10-24 10:33:11', 219.743, 225.743), ('android', 1.0, '2017-10-24 10:37:22', '2017-10-24 10:37:50', 93.863, 121.503), ('android', 1.0, '2017-10-24 10:37:56', '2017-10-24 10:38:10', 107.384, 119.983), ('android', 1.0, '2017-10-24 10:38:33', '2017-10-24 10:38:35', 220.0, 222.263), ('android', 0.5, '2017-10-24 10:39:56', '2017-10-24 10:40:30', 204.903, 221.823), ('android', 0.5, '2017-10-24 10:41:27', '2017-10-24 10:41:33', 219.09, 221.303), ('android', 0.5, '2017-10-24 10:41:40', '2017-10-24 10:41:47', 218.326, 221.343), ('android', 0.5, '2017-10-24 10:42:11', '2017-10-24 10:42:28', 216.884, 224.543), ('android', 0.5, '2017-10-24 10:42:36', '2017-10-24 10:42:48', 218.154, 224.383), ('android', 0.5, '2017-10-24 10:44:02', '2017-10-24 10:44:09', 217.041, 219.223), ('android', 0.5, '2017-10-24 10:44:25', '2017-10-24 10:44:29', 219.663, 221.663), ('android', 0.5, '2017-10-24 10:44:39', '2017-10-24 10:44:43', 222.063, 224.543), ('android', 0.5, '2017-10-24 10:45:46', '2017-10-24 10:46:00', 218.575, 224.863), ('android', 0.5, '2017-10-24 10:46:12', '2017-10-24 10:46:21', 221.128, 224.703), ('android', 0.5, '2017-10-24 10:47:02', '2017-10-24 10:47:12', 221.987, 225.463), ('android', 0.5, '2017-10-24 10:47:23', '2017-10-24 10:47:32', 223.098, 226.303), ('android', 0.5, '2017-10-24 10:47:35', '2017-10-24 10:47:41', 218.333, 221.223), ('android', 0.5, '2017-10-24 10:47:41', '2017-10-24 10:47:52', 221.263, 226.383), ('android', 0.5, '2017-10-24 10:48:05', '2017-10-24 10:48:11', 226.698, 228.863), ('android', 0.5, '2017-10-24 10:48:17', '2017-10-24 10:48:31', 221.503, 227.743), ('android', 0.5, '2017-10-24 10:48:32', '2017-10-24 10:48:38', 226.725, 229.063), ('android', 0.5, '2017-10-24 10:48:43', '2017-10-24 10:48:49', 224.765, 226.943), ('android', 0.5, '2017-10-24 10:48:49', '2017-10-24 10:49:04', 222.191, 229.583), ('android', 0.5, '2017-10-24 10:49:04', '2017-10-24 10:49:09', 226.134, 228.703), ('android', 0.5, '2017-10-24 10:49:09', '2017-10-24 10:49:28', 221.048, 229.383), ('android', 0.5, '2017-10-24 10:49:28', '2017-10-24 10:49:46', 229.423, 238.303), ('android', 1.0, '2017-10-24 10:54:31', '2017-10-24 10:55:02', 199.903, 230.263), ('android', 1.0, '2017-10-24 10:55:29', '2017-10-24 10:55:31', 231.743, 234.143), ('android', 1.0, '2017-10-24 10:55:57', '2017-10-24 10:56:01', 235.103, 238.943), ('android', 1.0, '2017-10-24 10:56:01', '2017-10-24 10:56:03', 238.983, 241.303), ('android', 1.0, '2017-10-24 10:56:52', '2017-10-24 10:56:54', 132.463, 134.543), ('android', 1.0, '2017-10-24 10:56:57', '2017-10-24 10:57:07', 124.223, 134.463), ('android', 1.0, '2017-10-24 10:57:11', '2017-10-24 10:57:14', 237.423, 240.383)]
for row in behavior:
	print(row)

video_length=358

event=[]
if behavior[0][1]==1.0:
	event.append(['pl',str2time(behavior[0][2]),behavior[0][5]-behavior[0][4]])
elif behavior[0][1]>1.0:
	event.append(['rf',str2time(behavior[0][2]),0])
	event.append(['pl',str2time(behavior[0][2]),behavior[0][5]-behavior[0][4]])
else:
	event.append(['rs',str2time(behavior[0][2]),0])
	event.append(['pl',str2time(behavior[0][2]),behavior[0][5]-behavior[0][4]])

for i in range(1,len(behavior)):
	if behavior[i][1]!=behavior[i-1][1]:#先判断是否有变速
		if behavior[i][1]==1.0:
			event.append(['rd',str2time(behavior[i][2]),0])
		elif behavior[i][1]>1.0:
			event.append(['rf',str2time(behavior[i][2]),0])
		else:
			event.append(['rs',str2time(behavior[i][2]),0])
	else:
		if abs(behavior[i][4]-behavior[i-1][5])<1:#暂停
			if str2time(behavior[i][2])-str2time(behavior[i-1][3])!=0:
			    event.append(['pa',str2time(behavior[i-1][3]),str2time(behavior[i][2])-str2time(behavior[i-1][3])])
		elif behavior[i][4]-behavior[i-1][5]>=1:#快进
			event.append(['sf',str2time(behavior[i][2]),behavior[i][4]-behavior[i-1][5]])
		else:#快退
			event.append(['sb',str2time(behavior[i][2]),behavior[i-1][5]-behavior[i][4]])
	
	event.append(['pl',str2time(behavior[i][2]),behavior[i][5]-behavior[i][4]])

#合并连续出现的相同动作
i=0
while True:
	if event[i][0]==event[i+1][0]:
		event[i][2]=event[i][2]+event[i+1][2]
		del event[i+1]
	else:
		i=i+1
	if i>=len(event)-1:
		break
		
print(event)
